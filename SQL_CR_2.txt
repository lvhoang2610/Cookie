SELECT
		in_out_whse_schedule_no,
		glb_parts_no,
		own_ttcg_company_cd,
		MIN(moving_turn) AS moving_turn
FROM
		t_in_out_whse_schedule
LEFT JOIN m_biz_partner_base ON
		t_in_out_whse_schedule.own_ttcg_company_cd = m_biz_partner_base.ttcg_company_cd
	AND t_in_out_whse_schedule.out_whse_base_glb_biz_partner_cd = m_biz_partner_base.glb_biz_partner_cd
	AND t_in_out_whse_schedule.out_whse_base_biz_partner_base_cd = m_biz_partner_base.biz_partner_base_cd
	AND m_biz_partner_base.is_deleted = 0
LEFT JOIN m_ttcg_base ON
		t_in_out_whse_schedule.own_ttcg_company_cd = m_ttcg_base.ttcg_company_cd
	AND t_in_out_whse_schedule.out_whse_base_ttcg_base_cd = m_ttcg_base.ttcg_base_cd
	AND m_ttcg_base.is_deleted = 0
WHERE
		(( m_ttcg_base.ttcg_company_cd = 'S005'
		AND m_ttcg_base.packing_instr_dest_flg = 1
		AND m_ttcg_base.is_deleted = 0
		AND t_in_out_whse_schedule.out_whse_base_base_type = '10' )
	OR
	( m_biz_partner_base.ttcg_company_cd = 'S005'
		AND m_biz_partner_base.packing_instr_dest_flg = 1
		AND m_biz_partner_base.is_deleted = 0
		AND t_in_out_whse_schedule.out_whse_base_base_type = '20' ) )
	AND own_ttcg_company_cd = 'S005'
	AND logistics_pattern_type = "02"
	AND (psi_crt_no = ""
		AND shipment_advisability_sts != "03"
		AND not EXISTS
		(SELECT
			 in_out_whse_schedule_no
		FROM
			t_in_out_whse_schedule tiows 
		WHERE
				psi_crt_no <>'')
)
GROUP BY
		in_out_whse_schedule_no,
		glb_parts_no,
		own_ttcg_company_cd